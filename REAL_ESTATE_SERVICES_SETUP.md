# إعداد خدمات Real Estate IT Solutions

## المشكلة
عند محاولة إضافة خدمات Real Estate من صفحة "Pricing Plans for Real Estate Professionals" إلى السلة، تظهر رسالة خطأ لأن هذه الخدمات غير موجودة كمنتجات في قاعدة البيانات.

## الحل

### الخطوة 1: إضافة الخدمات كمنتجات في قاعدة البيانات

قم بتشغيل السكريبت SQL التالي في قاعدة البيانات:

```bash
psql -U drivepixel_user -d drivepixel_db -f backend/add_real_estate_services.sql
```

أو يمكنك تشغيله يدوياً من pgAdmin أو أي أداة إدارة PostgreSQL.

### الخطوة 2: التحقق من إضافة المنتجات

بعد تشغيل السكريبت، تحقق من إضافة المنتجات:

```sql
SELECT id, name, price, category 
FROM products 
WHERE category = 'real-estate-services' 
ORDER BY name;
```

يجب أن ترى 20 منتجاً (5 خدمات × 4 فترات اشتراك).

### الخطوة 3: اختبار إضافة الخدمات إلى السلة

1. افتح صفحة Real Estate IT Solutions: `/services/real-estate`
2. اذهب إلى قسم "Pricing Plans for Real Estate Professionals"
3. اختر أي خدمة واختر فترة الاشتراك (Monthly, 1-Year, 3-Year, 5-Year)
4. اضغط على "Add to Cart"
5. يجب أن ترى رسالة نجاح وتحديث عدد المنتجات في السلة

## تفاصيل الخدمات

### الخدمات المتوفرة:

1. **100% Sponsorship**
   - Monthly: $176
   - 1-Year: $149.60
   - 3-Year: $140.80
   - 5-Year: $132

2. **IDX-DLFX**
   - Monthly: $90
   - 1-Year: $82
   - 3-Year: $76.50
   - 5-Year: $72

3. **Website + E-Mail**
   - Monthly: $160
   - 1-Year: $144
   - 3-Year: $136
   - 5-Year: $128

4. **1 Creative Yard Post Sign Unit**
   - Monthly: $190
   - 1-Year: $171
   - 3-Year: $161.50
   - 5-Year: $152

5. **5 Creative Yard Post Sign Units**
   - Monthly: $950
   - 1-Year: $855
   - 3-Year: $807.50
   - 5-Year: $760

## كيفية عمل النظام

### 1. البحث عن المنتج
عندما يضغط المستخدم على "Add to Cart"، يقوم النظام بالبحث عن المنتج في قاعدة البيانات بناءً على:
- اسم الخدمة (مثل: "100% Sponsorship")
- فترة الاشتراك (مثل: "1-Year")

### 2. تنسيق اسم المنتج
النظام يبحث عن المنتج بالتنسيقات التالية:
- `"100% Sponsorship - 1-Year"`
- `"100% Sponsorship (1-Year)"`
- `"100% Sponsorship 1-Year"`

### 3. إضافة إلى السلة
بعد العثور على المنتج، يتم إضافته إلى السلة بكمية 1 (لأنها خدمة وليست منتج مادي).

## الاشتراكات السنوية

### كيف تعمل الاشتراكات:

1. **عند الشراء:**
   - يتم إنشاء طلب في قاعدة البيانات
   - يتم ربط الطلب بالعميل
   - يتم حفظ نوع الاشتراك (monthly, 1-year, 3-year, 5-year)

2. **بعد الدفع:**
   - يتم تحديث حالة الطلب إلى "completed"
   - يتم إنشاء حساب للعميل (إذا لم يكن موجوداً)
   - يتم إرسال بريد تأكيد مع رابط الدخول

3. **الوصول إلى الخدمة:**
   - يمكن للعميل الدخول إلى `/dashboard`
   - يمكنه رؤية جميع الخدمات المشتراة
   - يمكنه إدارة اشتراكاته

## إضافة خدمات جديدة

لإضافة خدمة جديدة:

### 1. أضف الخدمة في الكود (page.tsx):

```typescript
const pricingPlans = [
  // ... الخدمات الموجودة
  {
    service: 'اسم الخدمة الجديدة',
    monthly: '$100',
    oneYear: '$90',
    threeYear: '$85',
    fiveYear: '$80'
  }
];
```

### 2. أضف المنتجات في قاعدة البيانات:

```sql
INSERT INTO products (name, description, price, category, is_active, availability)
VALUES 
('اسم الخدمة الجديدة - Monthly', 'وصف الخدمة', 100.00, 'real-estate-services', true, 999),
('اسم الخدمة الجديدة - 1-Year', 'وصف الخدمة', 90.00, 'real-estate-services', true, 999),
('اسم الخدمة الجديدة - 3-Year', 'وصف الخدمة', 85.00, 'real-estate-services', true, 999),
('اسم الخدمة الجديدة - 5-Year', 'وصف الخدمة', 80.00, 'real-estate-services', true, 999);
```

## استكشاف الأخطاء

### المشكلة: "Service is not available as a product yet"

**الحل:**
1. تحقق من أن المنتجات موجودة في قاعدة البيانات
2. تحقق من أن اسم المنتج يطابق تماماً اسم الخدمة + فترة الاشتراك
3. افتح Console في المتصفح وتحقق من الرسائل

### المشكلة: الخدمة تضاف ولكن لا تظهر في السلة

**الحل:**
1. تحقق من أن `sessionId` يعمل بشكل صحيح
2. تحقق من أن Backend يعمل
3. افتح Network tab وتحقق من استجابة API

### المشكلة: بعد الدفع لا يتم تحديث حالة الطلب

**الحل:**
1. تحقق من أن PayPal webhook يعمل
2. تحقق من logs في Backend
3. تحقق من أن `paypalController` يحدث قاعدة البيانات

## ملاحظات مهمة

1. **الخدمات ليست منتجات مادية:**
   - لا تحتاج إلى عنوان شحن
   - الكمية دائماً 1
   - يتم التفعيل فوراً بعد الدفع

2. **الاشتراكات:**
   - يتم حفظ نوع الاشتراك في جدول `orders`
   - يمكن للعميل رؤية تاريخ انتهاء الاشتراك
   - يمكن تجديد الاشتراك من Dashboard

3. **الأمان:**
   - جميع الأسعار يتم التحقق منها في Backend
   - لا يمكن التلاعب بالأسعار من Frontend
   - PayPal يتحقق من المبلغ قبل الدفع

## الدعم

إذا واجهت أي مشكلة:
1. تحقق من Console في المتصفح
2. تحقق من Backend logs
3. تحقق من قاعدة البيانات
4. راجع هذا الملف للحلول
